# global -- Global overrides
global:
  storageClass: local-path

# clickhouse -- Log storage and 7-day retention
clickhouse:
  enabled: true
  configData:
    ttl_for_logs: 7
  persistence:
    storageClass: local-path

# signoz -- UI settings with NodePort 30080
signoz:
  service:
    type: NodePort
    nodePort: 30080
  persistence:
    storageClass: local-path

# presets -- Standard SigNoz configurations for log/metric collection
presets:
  logsCollection:
    enabled: true
    blacklist:
      enabled: true
      signozLogs: false
      namespaces:
        - kube-system
      pods:
        - hotrod
        - locust
      containers: []
      additionalExclude: []

# otelCollector -- Central Gateway to ClickHouse
otelCollector:
  enabled: true
  config:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: 0.0.0.0:4317
          http:
            endpoint: 0.0.0.0:4318
    
    processors:
      batch:
        send_batch_size: 10000
        timeout: 10s

    exporters:
      clickhousetraces:
        datasource: tcp://${env:CLICKHOUSE_USER}:${env:CLICKHOUSE_PASSWORD}@${env:CLICKHOUSE_HOST}:${env:CLICKHOUSE_PORT}/${env:CLICKHOUSE_TRACE_DATABASE}
        use_new_schema: true
      signozclickhousemetrics:
        dsn: tcp://${env:CLICKHOUSE_USER}:${env:CLICKHOUSE_PASSWORD}@${env:CLICKHOUSE_HOST}:${env:CLICKHOUSE_PORT}/${env:CLICKHOUSE_DATABASE}
        timeout: 45s
      clickhouselogsexporter:
        dsn: tcp://${env:CLICKHOUSE_USER}:${env:CLICKHOUSE_PASSWORD}@${env:CLICKHOUSE_HOST}:${env:CLICKHOUSE_PORT}/${env:CLICKHOUSE_LOG_DATABASE}
        timeout: 10s
        use_new_schema: true

    service:
      pipelines:
        traces:
          receivers: [otlp]
          processors: [batch]
          exporters: [clickhousetraces]
        metrics:
          receivers: [otlp]
          processors: [batch]
          exporters: [signozclickhousemetrics]
        logs:
          receivers: [otlp]
          processors: [batch]
          exporters: [clickhouselogsexporter]
